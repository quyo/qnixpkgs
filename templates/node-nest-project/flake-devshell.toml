[devshell]
name = "node-nest-project devshell"
packages = [ "devenv" ]


[[env]]
name = "PROJECT_NAME"
value = "node-nest-project"


[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; code . ; popd"
name = "edit"
help = "launch vscode with debugging configuration."
category = "1. code"

[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; npm run lint ; popd"
name = "lint"
help = "run eslint & stylelint."
category = "1. code"

[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; npm run prettify ; popd"
name = "prettify"
help = "run prettier."
category = "1. code"


[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; npm run dev ; popd"
name = "dev"
help = "build. serve. watch.     (process.env[\"NODE_ENV\"] === \"development\")"
category = "2. build"

[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; npm run prod ; popd"
name = "prod"
help = "build. serve.            (process.env[\"NODE_ENV\"] === \"production\")"
category = "2. build"


[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; docker build -t quyo/${PROJECT_NAME}:dev . ; popd"
name = "cbuild"
help = "build docker image (FROM node)."
category = "3. dockerize"

[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; docker build -t quyo/${PROJECT_NAME}:dev -f Dockerfile.nix . ; popd"
name = "cbuild.nix"
help = "build docker image (FROM nix)."
category = "3. dockerize"

[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; docker push quyo/${PROJECT_NAME}:dev ; popd"
name = "cpush"
help = "push docker image."
category = "3. dockerize"

[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; docker-compose up ; popd"
name = "crun"
help = "run docker container."
category = "3. dockerize"


[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; flyctl launch ; popd"
name = "flaunch"
help = "launch Fly.io project."
category = "4. deploy"

[[commands]]
command = "pushd \"${PRJ_ROOT}\" ; flyctl deploy ; (LANG=C perl -e 'sleep 15') ; flyctl status ; flyctl info; flyctl open ; popd"
name = "fpush"
help = "deploy to Fly.io."
category = "4. deploy"
